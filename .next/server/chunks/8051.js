"use strict";exports.id=8051,exports.ids=[8051],exports.modules={86333:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(76557).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},12714:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(76557).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},69508:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(76557).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]])},98091:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(76557).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},10220:(e,t,a)=>{a.d(t,{R:()=>p});var r=a(10326),s=a(17577),l=a(91664),i=a(71815),n=a(82015),c=a(69508),d=a(12714);let o=(0,a(76557).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);var m=a(41206),h=a(21468),x=a(20800);function p({value:e,onChange:t,onSend:a,placeholder:p="\xc9crivez votre message...",disabled:u=!1}){let[f,y]=(0,s.useState)("edit"),g=`
### Formatage de base
**Gras** ou __Gras__
*Italique* ou _Italique_
~~Barr\xe9~~

### Listes
- Item 1
- Item 2
  - Sous-item

1. Premier
2. Deuxi\xe8me

### Liens et images
[Texte du lien](https://example.com)

### Code
\`Code en ligne\`

\`\`\`javascript
// Bloc de code
function hello() {
  console.log("Hello world!");
}
\`\`\`

### Citations
> Ceci est une citation

### Tableaux
| Colonne 1 | Colonne 2 |
|-----------|-----------|
| Cellule 1 | Cellule 2 |
  `;return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(i.mQ,{defaultValue:"edit",value:f,onValueChange:y,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)(i.dr,{children:[(0,r.jsxs)(i.SP,{value:"edit",className:"flex items-center gap-1",children:[r.jsx(c.Z,{className:"h-3.5 w-3.5"}),r.jsx("span",{children:"\xc9diter"})]}),(0,r.jsxs)(i.SP,{value:"preview",className:"flex items-center gap-1",children:[r.jsx(d.Z,{className:"h-3.5 w-3.5"}),r.jsx("span",{children:"Aper\xe7u"})]})]}),r.jsx(l.z,{variant:"link",size:"sm",className:"text-xs text-muted-foreground",onClick:()=>{alert("Ctrl+Enter pour envoyer\n\n"+g)},children:"Guide Markdown"})]}),r.jsx(i.nU,{value:"edit",className:"mt-0",children:r.jsx(n.g,{value:e,onChange:e=>t(e.target.value),placeholder:p,className:"min-h-[120px] font-mono text-sm",onKeyDown:e=>{"Enter"===e.key&&e.ctrlKey&&(e.preventDefault(),a())},disabled:u})}),r.jsx(i.nU,{value:"preview",className:"mt-0 border rounded-md p-3 min-h-[120px] bg-muted/30",children:e?r.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:r.jsx(m.UG,{components:{code:({node:e,inline:t,className:a,children:s,...l})=>{let i=/language-(\w+)/.exec(a||"");return!t&&i?r.jsx(h.Z,{style:x.Z,language:i[1],PreTag:"div",...l,children:String(s).replace(/\n$/,"")}):r.jsx("code",{className:a,...l,children:s})}},children:e})}):r.jsx("p",{className:"text-sm text-muted-foreground",children:"Rien \xe0 pr\xe9visualiser"})})]}),r.jsx("div",{className:"flex justify-end",children:(0,r.jsxs)(l.z,{onClick:a,disabled:u||!e.trim(),className:"flex items-center gap-1",children:[r.jsx(o,{className:"h-4 w-4"}),r.jsx("span",{children:"Envoyer"}),r.jsx("span",{className:"ml-1 text-xs opacity-70",children:"(Ctrl+Enter)"})]})})]})}},93325:(e,t,a)=>{a.d(t,{O:()=>j});var r=a(10326),s=a(17577),l=a(76557);let i=(0,l.Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),n=(0,l.Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);var c=a(94019),d=a(91664),o=a(51223);function m({onFileSelect:e,onFileRemove:t,selectedFile:a,previewUrl:l,className:m,accept:h="image/*",maxSizeMB:x=5}){let[p,u]=(0,s.useState)(!1),[f,y]=(0,s.useState)(null),g=(0,s.useRef)(null),[v,j]=(0,s.useState)(l||null),N=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?u(!0):"dragleave"===e.type&&u(!1)},k=e=>{if(e.size>1048576*x)return y(`Le fichier est trop volumineux. Taille maximale: ${x}MB`),!1;if(h&&"*"!==h){let t=e.type;if(!h.split(",").map(e=>e.trim()).some(e=>!!("image/*"===e&&t.startsWith("image/"))||e===t))return y(`Type de fichier non accept\xe9. Types accept\xe9s: ${h}`),!1}return y(null),!0},b=t=>{j(URL.createObjectURL(t)),e(t)},w=a?.type.startsWith("image/")||v&&!a?.type.startsWith("application/");return(0,r.jsxs)("div",{className:(0,o.cn)("w-full",m),children:[v?(0,r.jsxs)("div",{className:"relative w-full border rounded-lg overflow-hidden border-gray-200 dark:border-gray-800",children:[w?r.jsx("div",{className:"relative aspect-video bg-gray-50 dark:bg-gray-900",children:r.jsx("img",{src:v,alt:"Aper\xe7u",className:"object-contain w-full h-full"})}):(0,r.jsxs)("div",{className:"flex items-center p-4 gap-3",children:[r.jsx(n,{className:"w-8 h-8 text-yellow-500"}),(0,r.jsxs)("div",{className:"flex-1 truncate",children:[r.jsx("p",{className:"font-medium truncate",children:a?.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[a?.size&&(a.size/1024/1024).toFixed(2)||"?"," MB"]})]})]}),r.jsx(d.z,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-6 w-6",onClick:()=>{g.current&&(g.current.value=""),j(null),y(null),t?.()},children:r.jsx(c.Z,{className:"h-4 w-4"})})]}):(0,r.jsxs)("div",{className:(0,o.cn)("relative flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg transition-colors cursor-pointer",p?"border-yellow-500 bg-yellow-50 dark:bg-yellow-900/10":"border-gray-200 dark:border-gray-800 hover:border-yellow-500 hover:bg-yellow-50 dark:hover:bg-yellow-900/10",f?"border-red-500 bg-red-50 dark:bg-red-900/10":""),onDragEnter:N,onDragLeave:N,onDragOver:N,onDrop:e=>{if(e.preventDefault(),e.stopPropagation(),u(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){let t=e.dataTransfer.files[0];k(t)&&b(t)}},onClick:()=>{g.current?.click()},children:[r.jsx("input",{ref:g,type:"file",className:"hidden",accept:h,onChange:e=>{if(e.preventDefault(),e.target.files&&e.target.files[0]){let t=e.target.files[0];k(t)&&b(t)}}}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[r.jsx(i,{className:"w-8 h-8 mb-2 text-yellow-500 dark:text-yellow-400"}),(0,r.jsxs)("p",{className:"mb-2 text-sm text-gray-600 dark:text-gray-300",children:[r.jsx("span",{className:"font-semibold",children:"Cliquez pour t\xe9l\xe9charger"})," ou glissez-d\xe9posez"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["image/*"===h?"PNG, JPG ou GIF":"Tous types de fichiers"," (max. ",x,"MB)"]})]})]}),f&&r.jsx("p",{className:"mt-1 text-sm text-red-500",children:f})]})}var h=a(29752);let x=(0,l.Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),p=(0,l.Z)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),u=(0,l.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),f=e=>new Promise((t,a)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>a(e)}),y=async(e,t)=>{try{let a=await f(e),r=await fetch(`/api/tickets/${t}/attachments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:e.name,fileType:e.type,fileSize:e.size,fileData:a})});if(!r.ok)throw Error("Erreur lors du t\xe9l\xe9chargement du fichier");return(await r.json()).fileUrl}catch(e){throw console.error("Erreur lors du t\xe9l\xe9chargement du fichier:",e),e}},g=async e=>{try{let t=await fetch(`/api/tickets/${e}/attachments`);if(!t.ok)throw Error("Erreur lors de la r\xe9cup\xe9ration des pi\xe8ces jointes");return(await t.json()).attachments}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration des pi\xe8ces jointes:",e),[]}};var v=a(59033);function j({ticketId:e,isAdmin:t=!1,readOnly:a=!1}){let[l,i]=(0,s.useState)(null),[o,f]=(0,s.useState)(!1),[j,N]=(0,s.useState)([]),[k,b]=(0,s.useState)(!0),w=async()=>{if(l)try{f(!0),await y(l,e);let t=await g(e);N(t),i(null),(0,v.Am)({title:"Fichier t\xe9l\xe9charg\xe9",description:"Le fichier a \xe9t\xe9 t\xe9l\xe9charg\xe9 avec succ\xe8s."})}catch(e){console.error("Erreur lors du t\xe9l\xe9chargement du fichier:",e),(0,v.Am)({title:"Erreur",description:"Impossible de t\xe9l\xe9charger le fichier.",variant:"destructive"})}finally{f(!1)}},z=async t=>{try{if(!(await fetch(`/api/tickets/${e}/attachments`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({attachmentId:t})})).ok)throw Error("Erreur lors de la suppression de la pi\xe8ce jointe");N(j.filter(e=>e.id!==t)),(0,v.Am)({title:"Pi\xe8ce jointe supprim\xe9e",description:"La pi\xe8ce jointe a \xe9t\xe9 supprim\xe9e avec succ\xe8s."})}catch(e){console.error("Erreur lors de la suppression de la pi\xe8ce jointe:",e),(0,v.Am)({title:"Erreur",description:"Impossible de supprimer la pi\xe8ce jointe.",variant:"destructive"})}},Z=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB",C=e=>e.startsWith("image/")?r.jsx(x,{className:"h-5 w-5 text-blue-500"}):r.jsx(n,{className:"h-5 w-5 text-blue-500"});return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(p,{className:"h-5 w-5"}),r.jsx("h3",{className:"text-lg font-medium",children:"Pi\xe8ces jointes"})]}),!a&&(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx(m,{onFileSelect:e=>{i(e)},onFileRemove:()=>{i(null)},selectedFile:l,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt",maxSizeMB:5}),l&&r.jsx(d.z,{onClick:w,disabled:o,className:"w-full",children:o?"T\xe9l\xe9chargement en cours...":"T\xe9l\xe9charger le fichier"})]}),r.jsx("div",{className:"space-y-2",children:k?r.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement des pi\xe8ces jointes..."}):0===j.length?r.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucune pi\xe8ce jointe"}):j.map(e=>r.jsx(h.Zb,{className:"p-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[C(e.fileType),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-medium",children:e.fileName}),r.jsx("p",{className:"text-xs text-muted-foreground",children:Z(e.fileSize)})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(d.z,{variant:"ghost",size:"icon",asChild:!0,children:r.jsx("a",{href:e.filePath,target:"_blank",rel:"noopener noreferrer",download:!0,children:r.jsx(u,{className:"h-4 w-4"})})}),(t||!a)&&r.jsx(d.z,{variant:"ghost",size:"icon",onClick:()=>z(e.id),children:r.jsx(c.Z,{className:"h-4 w-4"})})]})]})},e.id))})]})}},82015:(e,t,a)=>{a.d(t,{g:()=>i});var r=a(10326),s=a(17577),l=a(51223);let i=s.forwardRef(({className:e,...t},a)=>r.jsx("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...t}));i.displayName="Textarea"}};