(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9377],{41761:function(e,s,t){Promise.resolve().then(t.bind(t,1099))},1099:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var r=t(57437),i=t(2265),a=t(99376),n=t(5090),c=t(12381),l=t(79820),d=t(69174),o=t(32660),u=t(18930),m=t(40282),x=t(69140),h=t(14438),j=t(27648),f=t(20665),g=t(90688),p=t(92349),v=t(38691);function N(e){let s=new Date(e);return new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)}function b(){let e=(0,a.useParams)(),s=(0,a.useRouter)(),t=e.id,[b,y]=(0,i.useState)(""),[k,w]=(0,i.useState)(!1),{data:E,loading:C,error:O,refetch:z}=(0,m.h_)("/api/tickets/".concat(e.id)),{data:A,error:_,loading:D,refetch:P}=(0,m.h_)("/api/tickets/".concat(e.id,"/messages")),{mutate:R,loading:S}=(0,m.Db)("/api/tickets/".concat(e.id,"/messages"),"POST"),{mutate:T,loading:Z}=(0,m.Db)("/api/tickets/".concat(e.id),"DELETE"),V=async()=>{w(!0);try{h.Am.loading("Suppression du ticket en cours...");let e=await fetch("/api/tickets/".concat(t),{method:"DELETE"});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.error||"Erreur ".concat(e.status,": ").concat(e.statusText))}h.Am.success("Le ticket a \xe9t\xe9 supprim\xe9 avec succ\xe8s."),setTimeout(()=>{s.push("/client/tickets")},1e3)}catch(e){console.error("Erreur lors de la suppression du ticket:",e),h.Am.error(e instanceof Error?e.message:"Une erreur est survenue lors de la suppression du ticket."),w(!1)}};return C?(0,r.jsxs)(v.Hn,{children:[(0,r.jsx)(n.X,{}),(0,r.jsx)(v.kV,{children:(0,r.jsx)("div",{className:"flex-1 p-6",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)(x.O,{className:"h-8 w-64 mb-4"}),(0,r.jsx)(x.O,{className:"h-32 w-full mb-6"}),(0,r.jsx)(x.O,{className:"h-64 w-full"})]})})})]}):O||!E?(0,r.jsxs)(v.Hn,{children:[(0,r.jsx)(n.X,{}),(0,r.jsxs)(v.kV,{children:[(0,r.jsx)("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 px-4",children:[(0,r.jsx)(v.vP,{}),(0,r.jsx)(c.z,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:(0,r.jsxs)(j.default,{href:"/client/tickets",children:[(0,r.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Retour"]})})]})}),(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("p",{className:"text-red-500 mb-4",children:"Impossible de charger les d\xe9tails du ticket. Veuillez r\xe9essayer plus tard."}),(0,r.jsx)(c.z,{asChild:!0,children:(0,r.jsx)(j.default,{href:"/client/tickets",children:"Retour aux tickets"})})]})]})]}):(0,r.jsxs)(v.Hn,{children:[(0,r.jsx)(n.X,{}),(0,r.jsxs)(v.kV,{children:[(0,r.jsx)("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b",children:(0,r.jsxs)("div",{className:"flex items-center justify-between w-full px-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v.vP,{}),(0,r.jsx)(c.z,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:(0,r.jsxs)(j.default,{href:"/client/tickets",children:[(0,r.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Retour"]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg font-semibold",children:E.title}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Ticket #",E.id," â€¢ ",N(E.createdAt)]})]})]}),(0,r.jsxs)(c.z,{variant:"destructive",size:"sm",onClick:V,disabled:k,children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Supprimer"]})]})}),(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(l.ll,{children:E.title}),function(e){switch(e){case"open":return(0,r.jsx)(d.C,{variant:"outline",className:"bg-yellow-500/10 text-yellow-500",children:"En attente"});case"in_progress":return(0,r.jsx)(d.C,{variant:"outline",className:"bg-blue-500/10 text-blue-500",children:"En cours"});case"closed":return(0,r.jsx)(d.C,{variant:"outline",className:"bg-green-500/10 text-green-500",children:"R\xe9solu"});default:return(0,r.jsx)(d.C,{variant:"outline",children:e})}}(E.status)]})}),(0,r.jsxs)(l.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium",children:"Description"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:E.description})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium",children:"Priorit\xe9"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"low"===E.priority?"Basse":"medium"===E.priority?"Moyenne":"high"===E.priority?"Haute":"Urgente"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium",children:"Cr\xe9\xe9 le"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:N(E.createdAt)})]})]})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{children:"Messages"})}),(0,r.jsx)(l.aY,{children:D?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(x.O,{className:"h-16 w-full"}),(0,r.jsx)(x.O,{className:"h-16 w-full"}),(0,r.jsx)(x.O,{className:"h-16 w-full"})]}):_?(0,r.jsx)("p",{className:"text-red-500",children:"Impossible de charger les messages. Veuillez r\xe9essayer plus tard."}):A&&A.length>0?(0,r.jsx)("div",{className:"space-y-4",children:A.map((e,s)=>(0,r.jsx)(p.K,{message:e,index:s},e.id))}):(0,r.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"Aucun message pour le moment."})}),(0,r.jsx)(l.eW,{children:(0,r.jsx)("div",{className:"w-full space-y-4",children:(0,r.jsx)(g.R,{value:b,onChange:y,onSend:()=>{b.trim()&&R({content:b}).then(()=>{y(""),P(),h.Am.success("Message envoy\xe9 avec succ\xe8s")}).catch(e=>{console.error("Erreur d\xe9taill\xe9e:",e),h.Am.error(e.message||"Erreur lors de l'envoi du message")})},placeholder:"\xc9crivez votre message ici...",disabled:S})})})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{children:"Informations du ticket"})}),(0,r.jsx)(l.aY,{children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium",children:"Statut"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"open"===E.status?"En attente":"in_progress"===E.status?"En cours":"R\xe9solu"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium",children:"Cat\xe9gorie"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"technical"===E.category?"Probl\xe8me technique":"billing"===E.category?"Facturation":"account"===E.category?"Compte":"feature"===E.category?"Demande de fonctionnalit\xe9":"Autre"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium",children:"Derni\xe8re mise \xe0 jour"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:N(E.updatedAt)})]})]})})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{children:"Pi\xe8ces jointes"})}),(0,r.jsx)(l.aY,{children:(0,r.jsx)(f.O,{ticketId:e.id})})]})]})]})})]})]})}},69174:function(e,s,t){"use strict";t.d(s,{C:function(){return c}});var r=t(57437);t(2265);var i=t(90535),a=t(93448);let n=(0,i.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:s,variant:t,...i}=e;return(0,r.jsx)("div",{className:(0,a.cn)(n({variant:t}),s),...i})}},69140:function(e,s,t){"use strict";t.d(s,{O:function(){return a}});var r=t(57437),i=t(93448);function a(e){let{className:s,...t}=e;return(0,r.jsx)("div",{className:(0,i.cn)("animate-pulse rounded-md bg-muted",s),...t})}}},function(e){e.O(0,[7317,912,2972,7861,9041,2556,6162,4438,9991,5090,2349,4596,2971,2117,1744],function(){return e(e.s=41761)}),_N_E=e.O()}]);